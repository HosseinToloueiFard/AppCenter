export struct AppShortcutData {
    name: string,
    icon_path: image,
    command: string,
}

export component AppLauncher inherits Window {
    in property <[[AppShortcutData]]> shortcut_rows; // لیست لیست شورتکات‌ها (برای صفحه فعلی)
    in-out property <string> name_text;
    in-out property <string> icon_text;
    in-out property <string> command_text;
    in-out property <bool> show_add_modal;

    callback run(string);
    callback add_shortcut(string, string, string);
    callback next_page();
    callback previous_page();

    width: 600px;
    height: 480px;
    title: "Launcher";

    Rectangle {
        width: 100%;
        height: 100%;
        background: #1e1e1e;

        VerticalLayout {
            padding: 10px;
            spacing: 10px;

            // نوار بالا
            HorizontalLayout {
                spacing: 10px;

                Rectangle {
                    horizontal-stretch: 1;
                    height: 1px;
                    background: transparent;
                }

                Rectangle {
                    width: 40px;
                    height: 40px;
                    background: #00aa00;
                    border-radius: 10px;

                    Text {
                        text: "+";
                        color: white;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    TouchArea {
                        clicked => { show_add_modal = true; }
                    }
                }
            }

            // لیست شورتکات‌ها
            for row in shortcut_rows: HorizontalLayout {
                spacing: 10px;

                for s in row: Rectangle {
                    width: 109px;
                    height: 130px;
                    background: #2e2e2e;
                    border-radius: 8px;

                    VerticalLayout {
                        padding: 8px;
                        spacing: 6px;

                        Image {
                            source: s.icon_path;
                            width: 90px;
                            height: 90px;
                            x: 10px; // حرکت به راست
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        Text {
                            text: s.name;
                            color: white;
                            horizontal-alignment: center;
                            vertical-alignment: top;
                            font-size: 12px;
                            max-height: 30px; // برای دو خط محدود می‌کنیم
                        }
                    }

                    TouchArea {
                        clicked => { run(s.command); }
                    }
                }
            }

            // دکمه‌های صفحه‌بندی پایین
            HorizontalLayout {
                spacing: 10px;
                alignment: center;

                Rectangle {
                    width: 80px;
                    height: 32px;
                    background: #444;
                    border-radius: 6px;

                    Text {
                        text: "Previous";
                        color: white;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }

                    TouchArea {
                        clicked => { previous_page(); }
                    }
                }

                Rectangle {
                    width: 80px;
                    height: 32px;
                    background: #444;
                    border-radius: 6px;

                    Text {
                        text: "Next";
                        color: white;
                        horizontal-alignment: center;
                        vertical-alignment: center;
                    }
                    TouchArea {
                        clicked => { next_page(); }
                    }
                }
            }
        }

        // مودال اضافه کردن
        if show_add_modal: Rectangle {
            width: 320px;
            height: 240px;
            background: #333;
            x: (parent.width - self.width) / 2;
            y: (parent.height - self.height) / 2;
            border-radius: 8px;

            VerticalLayout {
                padding: 12px;
                spacing: 12px;

                Text { text: "Name:"; color: white; }
                TextInput { text <=> name_text; }

                Text { text: "Icon Path:"; color: white; }
                TextInput { text <=> icon_text; }

                Text { text: "Command:"; color: white; }
                TextInput { text <=> command_text; }

                HorizontalLayout {
                    spacing: 12px;

                    Rectangle {
                        width: 70px;
                        height: 36px;
                        background: #00aa00;
                        border-radius: 6px;

                        Text {
                            text: "Add";
                            color: white;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        TouchArea {
                            clicked => {
                                add_shortcut(name_text, icon_text, command_text);
                                show_add_modal = false;
                            }
                        }
                    }

                    Rectangle {
                        width: 70px;
                        height: 36px;
                        background: #aa0000;
                        border-radius: 6px;

                        Text {
                            text: "Cancel";
                            color: white;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }

                        TouchArea {
                            clicked => { show_add_modal = false; }
                        }
                    }
                }
            }
        }
    }
}